/* APH Prism Highlighter */
!function(e){var a="";show_language=!0,data_line="",$iframe_body="",$aphph_btn="",default_lang="php",$cursor_node="",new_lang=default_lang,pre_tag_highlighted=0,aphph_tag_highlighted=0,options=e.parseJSON(e.trim(e("#aphph-json-user-options").text())),tinymce.create("tinymce.plugins.Aph_Prism_Highlighter",{init:function(t,h){function r(){$aphph_btn||($aphph_btn=e(t.targetElm).prev().find("div[class*='aphph-btn']"))}function n(){aphph_tag_highlighted&&(r(),$aphph_btn.removeClass("mce-active"),aphph_tag_highlighted=0)}function p(){pre_tag_highlighted&&($iframe_body||($iframe_body=e(t.targetElm)),$iframe=$iframe_body.prev().find("iframe"),$iframe.contents().find("pre").removeClass("aphph-pretag-focused"),$iframe_body.parent().find("pre").removeClass("aphph-pretag-focused"),pre_tag_highlighted=0)}function i(){var a=t.selection.getNode();if($cursor_node=e(a),"pre"==a.nodeName.toLowerCase()){var h=$cursor_node.attr("class");h&&(h.match(/lang\s*:/)?(p(),r(),$aphph_btn.addClass("mce-active"),aphph_tag_highlighted=1,pre_tag_highlighted=1,$cursor_node.addClass("aphph-pretag-focused")):(p(),n()))}else p(),n()}t.onKeyUp.add(function(e,a){i()}),t.addButton("aphph",{title:"APH Prism Highlighter",classes:"aphph-btn",cmd:"aphph",image:h+"/img/aphph-button.png",onClick:function(a){$aphph_btn=e(a.target).parent().parent()}}),t.addCommand("aphph",function(){var h=t.selection.getNode(),r=h.nodeName.toLowerCase(),n=t.selection.getContent({format:"text"}),p="",i=0,s="",o=aphph_default_lang;if(class_name="",show_ln="false","pre"==r){$pre=e(h);var l=$pre.attr("class");if(l.match(/lang\s*:/)){for(k in l=l.replace(/\s*:\s*/,":"),list_classes=l.split(" "),list_classes){var c=list_classes[k].split(":"),d=e.trim(c[1]);-1!=list_classes[k].indexOf("lang")?o=d:-1!=list_classes[k].indexOf("mark")?p=d:-1!=list_classes[k].indexOf("gutter")?(i=1,show_ln=d):-1!=list_classes[k].indexOf("start")?s=d:-1!=list_classes[k].indexOf("class")&&(class_name=d.replace(/\s+/gi,";"))}n=$pre.text(),a=$pre}}e("#aphph-language").find("option").removeAttr("selected"),e("#aphph-language").find('option[value="'+o+'"]').prop("selected",!0),e("#aphph-highlight-lines").val(p),e("#aphph-editor-code").val(n),i?e("#aphph-overr-showln").attr("checked","checked"):e("#aphph-overr-showln").removeAttr("checked"),e("#aphph-opt-showln").val(show_ln),e("#aphph-start-number").val(s),e("#aphph-input-class-name").val(class_name),e("#aphph-editor-overlay").show(),e("#aphph-editor-wrap").show(),e("#aphph-language").find('option[selected="selected"]').prop("selected",!0),i||class_name?e("#aphph-other-options-container").is(":hidden")&&(e("#aphph-other-options").trigger("click"),e("#aphph-editor-body").scrollTop(0)):e("#aphph-other-options-container").is(":hidden")||e("#aphph-other-options").trigger("click"),e("#aphph-submit").unbind("click").click(function(h){var r="lang:"+e("#aphph-language").val(),n="";if(e("#aphph-overr-showln").is(":checked")){var i=e.trim(e("#aphph-start-number").val())||1,s=e.trim(e("#aphph-opt-showln").val());n=" gutter:"+s+("true"==s?" start:"+i:"")}var o=e.trim(e("#aphph-input-class-name").val()),l=o?" class:"+o:"";if(p=e.trim(e("#aphph-highlight-lines").val()),data_highlight_line=p?" mark:"+p:"",$div=e("<div/>"),clean_code=e.trim(e("#aphph-editor-code").val()),encoded_html=$div.text(clean_code).html(),$div.remove(),class_name=r+data_highlight_line+n+l,a.length){if(""==clean_code)return void a.remove();console.log(a),a.attr("class",class_name).html(encoded_html)}else{if(""==clean_code)return;$pre=e('<pre class="'+class_name+'">'+encoded_html+"</pre>"),$cursor_node||($cursor_node=e(t.targetElm).prev().find("iframe").contents().find("p").eq(0)),$cursor_node.append($pre.removeClass("aphph-pretag-focused")),$prev=$pre.prev(),$prev.length>0&&"br"==$prev.prop("tagName").toLowerCase()&&$prev.remove(),$next=$cursor_node.next(),0==$next.length&&e("<p><br/></p>").insertAfter($cursor_node)}a="",$aphph_btn.removeClass("mce-active"),e("#aphph-cancel").trigger("click")})}),t.on("click",function(e){i()})},getInfo:function(){return{longname:"APH Prism Highlighter",author:"Agus Prawoto Hadi",authorurl:"https://jagowebdev.com",infourl:"https://jagowebdev.com",version:"1.0"}}}),tinymce.PluginManager.add("aphph_tinymce_btn",tinymce.plugins.Aph_Prism_Highlighter)}(jQuery);